<!DOCTYPE html>
<html>
<head>
  <title>Getting Data</title>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="generator" content="pandoc" />




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <base target="_blank">

  <script type="text/javascript">
    var SLIDE_CONFIG = {
      // Slide settings
      settings: {
                title: 'Getting Data',
                        useBuilds: true,
        usePrettify: true,
        enableSlideAreas: true,
        enableTouch: true,
                        favIcon: 'GettingData_files/logo.png',
              },

      // Author information
      presenters: [
            {
        name:  'Andrew Redd, PhD.' ,
        company: '',
        gplus: '',
        twitter: '',
        www: '',
        github: ''
      },
            ]
    };
  </script>

  <script type='text/javascript' id='timer-js'>
  var counts = {};
  var timers = {};
  var initial = {};
  function startTimer() {
  	//var count = initial;
  	var trigger = event.target;
  	var div = trigger.parentNode;
  	console.log("startTimer triggered by click on " + div.nodeName + "#" + div.id + ">" + trigger.nodeName);
  	var eid = div.id;
  	var warning = (div.hasAttribute("warnafter")) ? (+div.getAttribute("warnafter")) : 0;
  	console.log("eid=" + eid + ", warning=" + warning);
      if (!(eid in initial)){
          var p = trigger;
  
          var init = trigger.innerHTML;
          console.log("init=" + init);
  
          var a = init.split(':');
          initial[eid] = (+a[0])*60 + (+a[1]);
          console.log("initial[eid]=", initial[eid]);
      }
      counts[eid] = initial[eid];
      if (eid in timers && timers[eid] != 0) {
          clearInterval(timers[eid]); timers[eid] = 0;
          var minutes = Math.floor((initial[eid] % (60 * 60)) / (60));
          var seconds = Math.floor((initial[eid] % (60)));
          document.getElementById(eid).innerHTML = hms(initial[eid]);
      } else {
          timers[eid] = setInterval(function() {
              // Time calculations for days, hours, minutes and seconds
              var count = counts[eid] - 1;
              if (count > 0) {
                  document.getElementById(eid).innerHTML = hms(count, count <= warning);
              } else {
                  document.getElementById(eid).innerHTML = "<p class='timesup'>0:00</p>";
                  clearInterval(timers[eid]);
                  timers[eid] = 0;
              }
              counts[eid] = count;
          }, 1000);
      }
  };
  function hms(count, warn) {
      var leading = ''
      var minutes = Math.floor((count % (60 * 60)) / (60));
      var seconds = Math.floor((count % (60)));
      if (seconds <= 9){
          leading = "0";
      }
      var start;
      if (warn) {
          start = "<p class='warning'>";
      } else {
          start = "<p>";
      }
      return start + minutes + ":" + leading +  seconds + "</p>";
  };
  </script>
  <script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
  <script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
  <script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
  <script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
  <link href="site_libs/ioslides-13.5.1/fonts/fonts.css" rel="stylesheet" />
  <link href="site_libs/ioslides-13.5.1/theme/css/default.css" rel="stylesheet" />
  <link href="site_libs/ioslides-13.5.1/theme/css/phone.css" rel="stylesheet" />
  <script src="site_libs/ioslides-13.5.1/js/modernizr.custom.45394.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/prettify.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/lang-r.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/lang-yaml.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/hammer.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/slide-controller.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/slide-deck.js"></script>

  <style type="text/css">

    b, strong {
      font-weight: bold;
    }

    em {
      font-style: italic;
    }

    summary {
      display: list-item;
    }

    slides > slide {
      -webkit-transition: all 0.4s ease-in-out;
      -moz-transition: all 0.4s ease-in-out;
      -o-transition: all 0.4s ease-in-out;
      transition: all 0.4s ease-in-out;
    }

    .auto-fadein {
      -webkit-transition: opacity 0.6s ease-in;
      -webkit-transition-delay: 0.4s;
      -moz-transition: opacity 0.6s ease-in 0.4s;
      -o-transition: opacity 0.6s ease-in 0.4s;
      transition: opacity 0.6s ease-in 0.4s;
      opacity: 0;
    }
/* https://github.com/ropensci/plotly/pull/524#issuecomment-468142578 */
slide:not(.current) .plotly.html-widget{
  display: block;
}

    slides > slide:not(.nobackground):before {
      font-size: 12pt;
      content: "";
      position: absolute;
      bottom: 20px;
      left: 60px;
      background: url(GettingData_files/logo.png) no-repeat 0 50%;
      -webkit-background-size: 30px 30px;
      -moz-background-size: 30px 30px;
      -o-background-size: 30px 30px;
      background-size: 30px 30px;
      padding-left: 40px;
      height: 30px;
      line-height: 1.9;
    }
  </style>

  <link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body style="opacity: 0">

<slides class="layout-widescreen">

  <slide class="title-slide segue nobackground">
        <aside class="gdbar"><img src="GettingData_files/logo.png"></aside>
        <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      
      <p data-config-presenter><!-- populated from slide_config.json --></p>
            <p style="margin-top: 6px; margin-left: -2px;">R Bootcamp 2020</p>
          </hgroup>
  </slide>

<slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>Getting Data</h2></hgroup><article  id="getting-data">

<img src='images/datatable.png' title=''/>

</article></slide><slide class=""><hgroup><h2>Local Data</h2></hgroup><article  id="local-data" class="build">

<p>Most data in R is held locally (i.e.¬†in memory).</p>

<p>Most functions for reading data are simple and obviously named.</p>

<ul>
<li>read.csv

<ul>
<li>reads in a comma separated file.</li>
</ul></li>
<li>read.fwf

<ul>
<li>reads fixed width format.</li>
</ul></li>
</ul>

</article></slide><slide class=""><hgroup><h2>Task</h2></hgroup><article  id="task" class="flexbox vcenter">

<p>Find a function that reads in Microsoft Excel &lsquo;xlsx&rsquo; files. Refer back to the <a href='Resources.html' title=''>Resources slides</a> if you need.</p>

<div class="timer" id="timer1" onclick="startTimer()">
<p>2:00</p></div>

</article></slide><slide class=""><hgroup><h2>Possible Answers</h2></hgroup><article  id="possible-answers">

<ul>
<li><a href='https://www.rdocumentation.org/packages/readxl/versions/1.3.1/topics/read_excel' title=''><code>readxl::read_excel()</code></a></li>
<li><a href='https://www.rdocumentation.org/packages/officer/versions/0.3.5/topics/read_xlsx' title=''><code>officer::read_excel()</code></a></li>
<li><a href='https://www.rdocumentation.org/packages/openxlsx/versions/4.1.0.1/topics/read.xlsx' title=''><code>openxlsx::read.xlsx()</code></a></li>
<li><a href='https://www.rdocumentation.org/packages/xlsx/versions/0.6.1/topics/read.xlsx' title=''><code>xlsx::read.xlsx()</code></a></li>
</ul>

</article></slide><slide class=""><hgroup><h2>Ebola Data</h2></hgroup><article  id="ebola-data">

<p>The first data set we will use comes from the <a href='https://data.humdata.org/dataset/ebola-cases-2014' title=''>Humanitarian Data Exchange</a>.<br/>It consists of the number of Ebola cases and deaths broken down by confirmed, probable and suspected.</p>

<aside class='note'><section><p>This is a good case of slightly messy data that will need a bit of cleaning before it is really usable.</p></section></aside>

</article></slide><slide class=""><hgroup><h2>Read in the data</h2></hgroup><article  id="read-in-the-data">

<pre class = 'prettyprint lang-r'>ebola.data.raw &lt;- readxl::read_excel(&quot;data/ebola-cases-and-deaths-who-gar-sitrep.xlsx&quot;)
head(ebola.data.raw)</pre>

<table class = 'rmdtable'>
<tr class="header">
<th align="left">Country</th>
<th align="left">Case def.</th>
<th align="right">Total cases</th>
<th align="right">Cases last 21 days</th>
<th align="right">Total deaths</th>
<th align="left">Country Report Date</th>
</tr>
<tr class="odd">
<td align="left">Guinea</td>
<td align="left">Confirmed</td>
<td align="right">3351</td>
<td align="right">0</td>
<td align="right">2083</td>
<td align="left">2015-12-27</td>
</tr>
<tr class="even">
<td align="left">Guinea</td>
<td align="left">Probable</td>
<td align="right">453</td>
<td align="right">NA</td>
<td align="right">453</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">Guinea</td>
<td align="left">Suspected</td>
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">Guinea</td>
<td align="left">All</td>
<td align="right">3804</td>
<td align="right">0</td>
<td align="right">2536</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">Liberia</td>
<td align="left">Confirmed</td>
<td align="right">3151</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">2015-05-09</td>
</tr>
<tr class="even">
<td align="left">Liberia</td>
<td align="left">Probable</td>
<td align="right">1879</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
</table>

</article></slide><slide class=""><hgroup><h2>Examining data</h2></hgroup><article  id="examining-data">

<p>Useful tools for examining data.</p>

<ul>
<li><code>str()</code> - &lsquo;structure&rsquo; of the data.</li>
<li><code>glimpse()</code> - more useful version of str and works on all tibbles.</li>
<li><code>head()</code> - first n rows.</li>
<li><code>tail()</code> - last n rows</li>
<li><code>summary()</code> - will give univariate summaries of variables.</li>
</ul>

</article></slide><slide class=""><hgroup><h2><code>glimpse()</code></h2></hgroup><article  id="glimpse">

<pre class = 'prettyprint lang-r'>glimpse(ebola.data.raw)</pre>

<pre >## Observations: 44
## Variables: 6
## $ Country               [3m[38;5;246m&lt;chr&gt;[39m[23m &quot;Guinea&quot;, &quot;Guinea&quot;, &quot;Guin...
## $ `Case def.`           [3m[38;5;246m&lt;chr&gt;[39m[23m &quot;Confirmed&quot;, &quot;Probable&quot;, ...
## $ `Total cases`         [3m[38;5;246m&lt;dbl&gt;[39m[23m 3351, 453, 0, 3804, 3151,...
## $ `Cases last 21 days`  [3m[38;5;246m&lt;dbl&gt;[39m[23m 0, NA, NA, 0, NA, NA, NA,...
## $ `Total deaths`        [3m[38;5;246m&lt;dbl&gt;[39m[23m 2083, 453, NA, 2536, NA, ...
## $ `Country Report Date` [3m[38;5;246m&lt;dttm&gt;[39m[23m 2015-12-27, NA, NA, NA, ...</pre>

</article></slide><slide class=""><hgroup><h2>Problem</h2></hgroup><article  id="problem" class="flexbox vcenter build">

<p>This is only one sheet üôÅ</p>

<img src='images/get_all_the_data.jpg' title=''/>

</article></slide><slide class=""><hgroup><h2>Read all the data</h2></hgroup><article  id="read-all-the-data" class="build">

<pre class = 'prettyprint lang-r'>library(readxl)
library(purrr)
data.file &lt;- &quot;data/ebola-cases-and-deaths-who-gar-sitrep.xlsx&quot;
sheets &lt;- excel_sheets(data.file)
all.ebola.raw.data &lt;- map(sheets, read_excel, path=data.file) %&gt;% 
    set_names(sheets)</pre>

<h3>Variants</h3>

<div class="columns-2">
<div class="column">
<ul>
<li><code>map()</code> = list,</li>
<li><code>map_lgl()</code> = logical,</li>
<li><code>map_int()</code> = integers,</li>
</ul></div>

<div class="column">
<ul>
<li><code>map_dbl()</code> = numbers,</li>
<li><code>map_chr()</code> = strings.</li>
</ul></div></div>

</article></slide><slide class=""><hgroup><h2>Quiz</h2></hgroup><article  id="quiz" class="flexbox vcenter build">

<p>What form is the all.ebola.raw.data in?</p>

<p>What form do we want it in?</p>

<h3>Task</h3>

<p>Collapse it into a single data.frame</p>

</article></slide><slide class=""><hgroup><h2>Possible solution</h2></hgroup><article  id="possible-solution" class="build">

<p>Change the reading function</p>

<pre class = 'prettyprint lang-r'>all.ebola.raw.data &lt;- 
    excel_sheets(data.file) %&gt;% #&lt; sheet names
    map_dfr(read_excel, path=data.file, .id = &quot;sheet&quot;)</pre>

<div class="R-error">
<p class="error-message">

Column <code>Total deaths</code> can‚Äôt be converted from numeric to character

</p></div>

</article></slide><slide class=""><hgroup><h2>Another solution - Fix the output</h2></hgroup><article  id="another-solution---fix-the-output" class="build">

<h3>1. Investigate why it failed.</h3>

<pre class = 'prettyprint lang-r'>all.ebola.raw.data %&gt;% keep(~is.character(.$`Total deaths`))</pre>

<div class="terminology">
<dl>
<dt>Lambda functions</dt>
<dd><p>Functions created from formulas(<code>~</code>) where the <code>.</code> is the argument.</p>

<p><code>?rlang::is_lambda</code></p></dd>
</dl></div>

<h3>Problems</h3>

<ol>
<li>Some variables are &lsquo;character&rsquo; that should be &lsquo;numeric&rsquo;</li>
<li>Not all sheets have the same number of columns.</li>
</ol>

<aside class='note'><section><p>Note everything in R supports lambda functions but they can be made explicit by wrapping it in <code>as_function()</code>.</p></section></aside>

</article></slide><slide class=""><hgroup><h2>Another solution - Fix the output</h2></hgroup><article  id="another-solution---fix-the-output-1" class="build">

<h3>2. Find the common variables</h3>

<pre class = 'prettyprint lang-r'>common.vars &lt;- all.ebola.raw.data %&gt;% 
    # a. Get the variable names for for each sheet
    map(tbl_vars) %&gt;% 
    # b. Only keep the variables that are common to all
    reduce(intersect)</pre>

<div class="keyfunction">
<dl>
<dt><code>reduce()</code></dt>
<dd><p>Take the first two elements apply the function, then take the output of that and the next element and apply the function, and so on until all elements have had the function applied. Return value of the last call.</p></dd>
</dl></div>

</article></slide><slide class=""><hgroup><h2>Another solution - Fix the output</h2></hgroup><article  id="another-solution---fix-the-output-2" class="build">

<h3>3. Combine together</h3>

<pre class = 'prettyprint lang-r'>all.ebola.raw.data.df &lt;- all.ebola.raw.data %&gt;% 
    map(select, !!!common.vars) %&gt;% 
    map( mutate_at, vars(starts_with(&quot;Total&quot;))
       , ~as.integer(na_if(., &#39;..&#39;))) %&gt;% 
    bind_rows(.id = &quot;SheetName&quot;)</pre>

<div class="terminology">
<dl>
<dt>Lazy evaluation</dt>
<dd><p>The select function expects unquoted variable names because it supports &lsquo;lazy evaluation&rsquo;. To over come this we need <code>!!!</code> or <code>!!</code> to indicate that the name should be interpreted as an object to be evaluated rather than a variable name directly.</p></dd>
</dl></div>

</article></slide><slide class=""><hgroup><h2>Time for some clean up</h2></hgroup><article  id="time-for-some-clean-up" class="build">

<pre class = 'prettyprint lang-r'>ebola.data &lt;- all.ebola.raw.data.df %&gt;% 
    # 1. Carry last value forward on date.
    mutate(`Country Report Date` = zoo::na.locf(`Country Report Date`)) %&gt;% 
    # 2. Fill in the missing values with 0.
    mutate_at(vars(starts_with(&quot;total&quot;)), coalesce, 0L)</pre>

<div class="concept">
<p>Note the <code>0L</code> which indicates an integer zero. If performed with the bare <code>0</code> the operation would fail with</p>

<div class="R-error">
<p>Argument 2 must be an integer vector, not a double vector</p></div></div>

</article></slide><slide class=""><hgroup><h2>Save it for future use</h2></hgroup><article  id="save-it-for-future-use">

<pre class = 'prettyprint lang-r'>save(ebola.data, file=&#39;data/ebola.data.RData&#39;)</pre>

<p>OR</p>

<pre class = 'prettyprint lang-r'>saveRDS(ebola.data, file=&#39;data/ebola.data.rds&#39;)</pre></article></slide>


  <slide class="backdrop"></slide>

</slides>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!-- map slide visiblity events into shiny -->
<script>
  (function() {
    if (window.jQuery) {
       window.jQuery(document).on('slideleave', function(e) {
         window.jQuery(e.target).trigger('hidden');
      });
       window.jQuery(document).on('slideenter', function(e) {
         window.jQuery(e.target).trigger('shown');
      });
    }
  })();
</script>

</body>
</html>
